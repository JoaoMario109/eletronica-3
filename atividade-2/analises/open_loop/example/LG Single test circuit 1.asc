Version 4
SHEET 1 1656 940
WIRE 1088 128 912 128
WIRE 368 144 288 144
WIRE 496 144 416 144
WIRE 1088 176 1088 128
WIRE 1200 192 1168 192
WIRE 1344 192 1280 192
WIRE 1536 192 1344 192
WIRE 288 208 288 144
WIRE 352 208 288 208
WIRE 496 224 496 144
WIRE 496 224 416 224
WIRE 1344 224 1344 192
WIRE 352 240 224 240
WIRE 1168 256 1168 192
WIRE 224 272 224 240
WIRE 1088 304 1088 256
WIRE 1088 304 912 304
WIRE 1168 320 1168 288
WIRE 1296 320 1168 320
WIRE 1344 320 1344 288
WIRE 1344 320 1296 320
WIRE 224 352 224 304
WIRE 1296 368 1296 320
WIRE 592 384 576 384
WIRE 608 384 592 384
WIRE 576 416 576 384
WIRE 576 528 576 496
WIRE 576 592 576 528
WIRE 576 720 576 672
FLAG 576 528 0
FLAG 592 384 VCC
FLAG 576 720 -VCC
FLAG 384 192 VCC
FLAG 384 256 -VCC
FLAG 224 352 0
FLAG 224 240 vi
FLAG 496 224 vout
FLAG 1296 368 0
FLAG 1088 128 +
FLAG 1088 304 -
SYMBOL voltage 576 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 15
SYMBOL LG_single 400 144 R0
SYMATTR InstName LGS
SYMBOL voltage 576 576 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 15
SYMBOL MiniSyms4\\signal- 224 288 R0
WINDOW 123 12 21 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC 10m
SYMATTR Value 1
SYMATTR InstName V3
SYMBOL Opamps\\UniversalOpamp 384 224 R0
SYMATTR InstName U1
SYMATTR Value2 Avol=1G GBW=1G Slew=1000G
SYMBOL MiniSyms4\\voltage- 1168 272 R0
SYMATTR InstName V4
SYMATTR Value Av * V(Ri)
SYMBOL res 1072 160 R0
SYMATTR InstName R1
SYMATTR Value Ri
SYMBOL res 1296 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value Ro
SYMBOL cap 1328 224 R0
SYMATTR InstName C1
TEXT -32 664 Left 2 !;op
TEXT -32 704 Left 2 !.param lg = 0 ; zero value turns off probe\n  .step param lg list -1 1
TEXT -32 776 Left 2 !.ac dec 1Meg 1 2Meg
TEXT -32 816 Left 2 !.meas AC phase_margin FIND -1/(1-1/(2*(I(LGS:Vi)@1*V(LGS:x)@2-V(LGS:x)@1*I(LGS:Vi)@2)+V(LGS:x)@1+I(LGS:Vi)@2))\n   + WHEN mag(-1/(1-1/(2*(I(LGS:Vi)@1*V(LGS:x)@2-V(LGS:x)@1*I(LGS:Vi)@2)+V(LGS:x)@1+I(LGS:Vi)@2)))=1
TEXT -24 896 Left 2 !.meas AC gain_margin FIND -1/(1-1/(2*(I(LGS:Vi)@1*V(LGS:x)@2-V(LGS:x)@1*I(LGS:Vi)@2)+V(LGS:x)@1+I(LGS:Vi)@2))\n   + WHEN ph(-1/(1-1/(2*(I(LGS:Vi)@1*V(LGS:x)@2-V(LGS:x)@1*I(LGS:Vi)@2)+V(LGS:x)@1+I(LGS:Vi)@2)))=0
LINE Normal 1024 448 1024 16 1
LINE Normal 1408 192 1024 448 1
LINE Normal 1024 -32 1408 192 1
LINE Normal 1024 16 1024 -32 1
